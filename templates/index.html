{% extends 'base.html' %}

{% block title %}TodaysFinds{% endblock %}

{% block extra_head %}
  <!-- (ì¶”ê°€ í—¤ë“œ ìš”ì†Œê°€ ì—†ë‹¤ë©´ ë¹„ì›Œ ë‘¡ë‹ˆë‹¤) -->
{% endblock %}

{% block content %}
<!-- êµ¬ê¸€ ë©”ì¸ì²˜ëŸ¼ ê¹”ë”í•œ ì¤‘ì•™ ì •ë ¬ ë””ìì¸ -->
<div class="flex flex-col items-center justify-center min-h-[calc(100vh-80px)] px-4">
  
  <!-- ë©”ì¸ íƒ€ì´í‹€ -->
  <h1 class="text-5xl font-medium text-[#3C1F1A] mb-12 tracking-tight">
    ì˜¤ëŠ˜ì˜ ì¶œì„
  </h1>

  <!-- ê²€ìƒ‰/ì„ íƒ ì˜ì—­ - ë°˜ì‘í˜• ê°œì„  -->
  <div class="w-full max-w-lg xl:max-w-xl mb-8">
    <div class="relative">
      <input
        type="text"
        id="nameInput"
        placeholder="ì´ë¦„ ì…ë ¥ ë˜ëŠ” ì„ íƒ"
        onfocus="showDropdown()"
        oninput="filterDropdown()"
        autocomplete="off"
        class="w-full border-2 border-gray-300 px-6 py-2 rounded-full text-lg focus:outline-none focus:border-[#3C1F1A]"
      />
      <div id="dropdown" class="dropdown-list"></div>
    </div>
    <!-- ë””ë²„ê¹…ìš© ì‹œê°„ í‘œì‹œ -->
    <div class="text-xs text-gray-500 mt-2 text-center" id="timeInfo"></div>
    <!-- ìœ íš¨ì„± ë©”ì‹œì§€ -->
    <div id="inputMessage" class="text-sm text-red-500 mt-2 text-center opacity-0"></div>
  </div>

  <!-- ì¶œì„ ë¦¬ìŠ¤íŠ¸ - ë°˜ì‘í˜• ê°œì„  -->
  <div class="w-full max-w-lg xl:max-w-xl">
    <div id="attendeeList" class="space-y-4 mb-8"></div>
    
    <!-- ì¶œì„ ì™„ë£Œ ë²„íŠ¼ -->
    <div class="text-center" id="completeSection" style="display: none;">
      <button
        id="completeBtn"
        class="bg-[#3C1F1A] text-white px-8 py-3 rounded-full font-medium hover:opacity-90 transition-opacity"
        onclick="completeAttendance()"
      >
        ì¶œì„ ì™„ë£Œ
      </button>
    </div>


  </div>

</div>

<!-- ì§€ê°ë¹„ íŒì—… -->
<div id="latePopup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg p-6 max-w-sm mx-4">
    <h3 class="text-lg font-semibold text-[#3C1F1A] mb-3">â° ì§€ê° ì•ˆë‚´</h3>
    <p class="text-gray-700 mb-4">ì§€ê°ì…ë‹ˆë‹¤.<br>ì§€ê°ë¹„ ì²œ ì› ì…ê¸ˆí•´ ì£¼ì„¸ìš”ğŸ’°</p>
    <div class="flex space-x-3">
      <button onclick="confirmLate()" class="flex-1 bg-[#3C1F1A] text-white py-2 px-4 rounded">í™•ì¸</button>
      <button onclick="closeLatePopup()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded">ì·¨ì†Œ</button>
    </div>
  </div>
</div>

<!-- ê²°ì„ ì‚¬ìœ  íŒì—… -->
<div id="absencePopup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg p-6 max-w-sm mx-4">
    <h3 class="text-lg font-semibold text-[#3C1F1A] mb-3">ğŸš« ê²°ì„ ì‚¬ìœ </h3>
    <textarea id="absenceReason" placeholder="(ì„ íƒ)" class="w-full border border-gray-300 rounded p-3 mb-4 h-20 resize-none"></textarea>
    <div class="flex space-x-3">
      <button onclick="confirmAbsence()" class="flex-1 bg-red-500 text-white py-2 px-4 rounded hover:bg-red-600">ê²°ì„ ì²˜ë¦¬</button>
      <button onclick="closeAbsencePopup()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded hover:bg-gray-400">ì·¨ì†Œ</button>
    </div>
  </div>
</div>

<!-- ì°¸ì—¬ë¹„ í™•ì¸ íŒì—… -->
<div id="paymentPopup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-xl p-8 max-w-md mx-4 shadow-2xl">
    <div class="text-center mb-6">
      <div class="text-4xl mb-3">ğŸ’°</div>
      <h3 class="text-xl font-semibold text-gray-800 mb-2">ì°¸ì—¬ë¹„ ì…ê¸ˆí•˜ì…¨ë‚˜ìš”?</h3>
    </div>
    <div class="flex space-x-4">
      <button onclick="confirmPayment(true)" class="flex-1 bg-[#3C1F1A] text-white py-3 px-6 rounded-lg text-base font-medium hover:opacity-90 transition-opacity">
        í–ˆì–´ìš”
      </button>
      <button onclick="confirmPayment(false)" class="flex-1 bg-gray-100 text-gray-700 py-3 px-6 rounded-lg text-base font-medium hover:bg-gray-200 transition-colors">
        í• ê²Œìš”
      </button>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  // ì„œë²„ì—ì„œ ë„˜ê²¨ì¤€ all_members ë°°ì—´ì„ JSë¡œ ë°›ê¸°
  const allMembers = {{ all_members | tojson | safe }};

  // DOM ìš”ì†Œë“¤
  const dropdown = document.getElementById("dropdown");
  const nameInput = document.getElementById("nameInput");
  const attendeeList = document.getElementById("attendeeList");
  const inputMessage = document.getElementById("inputMessage");
  const latePopup = document.getElementById("latePopup");
  const absencePopup = document.getElementById("absencePopup");
  const absenceReason = document.getElementById("absenceReason");
  const completeSection = document.getElementById("completeSection");

  // ì „ì—­ ë³€ìˆ˜
  let attendees = JSON.parse(localStorage.getItem("today_attendees") || "[]");
  let currentProcessingIndex = -1;
  
  // ì¶œì„ íšŸìˆ˜ (localStorage + ì„œë²„ ë™ê¸°í™”)
  let memberAttendanceCounts = {};
  
  // ëª¨ì„ ì‹œê°„ ì„¤ì • (ìš”ì¼ë³„)
  const MEETING_TIMES = {
    6: { // í† ìš”ì¼
      lateStartHour: 10,
      lateStartMinute: 1,
      lateEndHour: 12,
      lateEndMinute: 0
    },
    4: { // ëª©ìš”ì¼
      lateStartHour: 19,
      lateStartMinute: 1,
      lateEndHour: 21,
      lateEndMinute: 0
    }
  };

  // ì´ˆê¸°í™”
  initializeAttendanceCounts();
  renderAttendees();

  // ì§€ê° ì‹œê°„ ì²´í¬ í•¨ìˆ˜
  function isLateTime() {
    const now = new Date();
    const dayOfWeek = now.getDay();
    const currentHour = now.getHours();
    const currentMinute = now.getMinutes();
    
    const meetingTime = MEETING_TIMES[dayOfWeek];
    if (!meetingTime) {
      return false; // ëª¨ì„ì¼ì´ ì•„ë‹ˆë©´ ì§€ê° ì—†ìŒ
    }
    
    const lateStart = meetingTime.lateStartHour * 60 + meetingTime.lateStartMinute;
    const lateEnd = meetingTime.lateEndHour * 60 + meetingTime.lateEndMinute;
    const currentTime = currentHour * 60 + currentMinute;
    
    // ì§€ê° ì‹œê°„ëŒ€ì—ë§Œ true ë°˜í™˜ (10:01-12:00, 19:01-21:00)
    return currentTime >= lateStart && currentTime <= lateEnd;
  }

  // ë“œë¡­ë‹¤ìš´ ê´€ë ¨ í•¨ìˆ˜ë“¤
  function showDropdown() {
    if (allMembers.length > 0) {
      dropdown.style.display = "block";
      renderDropdown(allMembers);
    }
  }
  
  function hideDropdown() {
    dropdown.style.display = "none";
  }
  
  function filterDropdown() {
    const query = nameInput.value.toLowerCase().trim();
    if (query === "") {
      renderDropdown(allMembers);
    } else {
      const filtered = allMembers.filter(name =>
        name.toLowerCase().includes(query)
      );
      renderDropdown(filtered);
    }
  }
  
  function renderDropdown(list) {
    dropdown.innerHTML = "";
    if (list.length === 0) {
      const noResult = document.createElement("div");
      noResult.className = "dropdown-item text-gray-500";
      noResult.textContent = "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤";
      dropdown.appendChild(noResult);
      return;
    }
    
    list.forEach(name => {
      const item = document.createElement("div");
      item.className = "dropdown-item";
      item.textContent = name;
      item.onclick = () => addAttendee(name);
      dropdown.appendChild(item);
    });
  }

  // ì¶œì„ì ì¶”ê°€ í•¨ìˆ˜
  function addAttendee(name) {
    if (!name || attendees.some(att => att.name === name)) {
      showMessage(inputMessage, attendees.some(att => att.name === name)
        ? "ì´ë¯¸ ì¶”ê°€ëœ íšŒì›ì…ë‹ˆë‹¤."
        : "ìœ íš¨í•œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
      return;
    }
    
    const now = new Date();
    attendees.push({ 
      name: name, 
      status: "pending", 
      time: now.toISOString(),
      absenceReason: ""
    });
    
    saveToLocalStorage();
    renderAttendees();
    nameInput.value = "";
    hideDropdown();
  }
  
  function saveToLocalStorage() {
    localStorage.setItem("today_attendees", JSON.stringify(attendees));
    localStorage.setItem("member_counts", JSON.stringify(memberAttendanceCounts));
    updateCompleteButton();
  }
  
  function updateCompleteButton() {
    const processedCount = attendees.filter(att => att.status !== "pending").length;
    if (processedCount > 0) {
      completeSection.style.display = "block";
    } else {
      completeSection.style.display = "none";
    }
  }
  
  function renderAttendees() {
    attendeeList.innerHTML = "";
    attendees.forEach((att, idx) => {
      const div = document.createElement("div");
      div.className = "bg-white rounded-lg border border-gray-300 p-4 flex justify-between items-center";
      div.id = `attendee-${idx}`;
      
      if (att.status === "pending") {
        div.innerHTML = `
          <span class="text-lg font-medium text-[#3C1F1A]">${att.name}</span>
          <div class="flex space-x-2">
            <button class="px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm hover:bg-green-200" onclick="processAttendance(${idx})">ì¶œì„</button>
            <button class="px-4 py-2 bg-red-100 text-red-700 rounded-full text-sm hover:bg-red-200" onclick="processAbsence(${idx})">ê²°ì„</button>
            <button class="px-3 py-2 bg-gray-100 text-gray-600 rounded-full text-sm hover:bg-gray-200" onclick="removeAttendee(${idx})">ì‚­ì œ</button>
          </div>
        `;
      } else {
        const statusDisplay = getStatusDisplay(att);
        div.innerHTML = `
          <div class="flex items-center space-x-3">
            <span class="text-lg font-medium text-[#3C1F1A]">${att.name}</span>
            <span class="text-sm ${getStatusColor(att.status)}">${statusDisplay}</span>
          </div>
          <div class="flex space-x-2">
            <button class="px-4 py-2 bg-yellow-100 text-yellow-700 rounded-full text-sm hover:bg-yellow-200" onclick="undoAttendance(${idx})">ì·¨ì†Œ</button>
            <button class="px-3 py-2 bg-gray-100 text-gray-600 rounded-full text-sm hover:bg-gray-200" onclick="removeAttendee(${idx})">ì‚­ì œ</button>
          </div>
        `;
      }
      attendeeList.appendChild(div);
    });
    updateCompleteButton();
  }

  // ì¶œì„ ì²˜ë¦¬ í•¨ìˆ˜ë“¤
  function processAttendance(index) {
    currentProcessingIndex = index;
    
    if (isLateTime()) {
      latePopup.classList.remove("hidden");
    } else {
      // ì°¸ì—¬ë¹„ í™•ì¸ íŒì—… í‘œì‹œ
      document.getElementById("paymentPopup").classList.remove("hidden");
    }
  }
  
  function confirmLate() {
    // ì§€ê° ìƒíƒœ ì €ì¥
    isCurrentlyLate = true;
    closeLatePopup();
    document.getElementById("paymentPopup").classList.remove("hidden");
  }
  
  function confirmAttendance(index, isLate) {
    const att = attendees[index];
    att.status = isLate ? "late" : "attended";
    att.time = new Date().toISOString();
    
    // ë¡œì»¬ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ (ì„œë²„ ì €ì¥ì€ ì¶œì„ ì™„ë£Œ ì‹œì—ë§Œ)
    loadUserAttendanceFromServer(att.name).then((count) => {
      // attended ë˜ëŠ” late ìƒíƒœ ëª¨ë‘ ì¹´ìš´íŠ¸ ì¦ê°€ (ì´ ì°¸ì„ íšŸìˆ˜)
      memberAttendanceCounts[att.name] = count + 1;
      saveToLocalStorage();
      renderAttendees();
    });
  }
  
  function processAbsence(index) {
    currentProcessingIndex = index;
    absenceReason.value = "";
    absencePopup.classList.remove("hidden");
  }
  
  function confirmAbsence() {
    const att = attendees[currentProcessingIndex];
    att.status = "absent";
    att.time = new Date().toISOString();
    att.absenceReason = absenceReason.value.trim();
    
    saveToLocalStorage();
    renderAttendees();
    closeAbsencePopup();
  }
  
  function undoAttendance(index) {
    if (confirm("ì¶œì„ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      const att = attendees[index];
      
      att.status = "pending";
      att.absenceReason = "";
      
      saveToLocalStorage();
      renderAttendees();
    }
  }

  // ì¶œì„ ì™„ë£Œ í•¨ìˆ˜
  function completeAttendance() {
    if (confirm("âš ï¸ ì£¼ì˜: ì¶œì„ ì™„ë£Œë¥¼ ëˆ„ë¥´ë©´ ì˜¤ëŠ˜ ë‚ ì§œì˜ ê¸°ì¡´ ëª¨ë“  ì¶œì„ ê¸°ë¡ì´ í˜„ì¬ ëª…ë‹¨ìœ¼ë¡œ êµì²´ë©ë‹ˆë‹¤.\n\nì •ë§ë¡œ ëª¨ì„ì„ ì™„ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      // ì²˜ë¦¬ëœ ì¶œì„ ê¸°ë¡ë§Œ í•„í„°ë§
      const processedAttendees = attendees.filter(att => att.status !== "pending");
      
      if (processedAttendees.length === 0) {
        alert("ì €ì¥í•  ì¶œì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      
      // ëª¨ë“  ì¶œì„ ê¸°ë¡ì„ í•œ ë²ˆì— ì„œë²„ì— ì €ì¥
      fetch('/api/save_all_attendance', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ attendees: processedAttendees })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'ok') {
          // ëª¨ì„ì¼ ë“±ë¡ API í˜¸ì¶œ
          return fetch('/api/complete_meeting', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
          });
        } else {
          throw new Error(data.message || 'ì¶œì„ ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨');
        }
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'ok') {
          localStorage.removeItem("today_attendees");
          localStorage.removeItem("member_counts");
          attendees = [];
          memberAttendanceCounts = {};
          renderAttendees();
          showMessage(inputMessage, "ëª¨ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ëª¨ë“  ì¶œì„ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
        } else {
          alert('ëª¨ì„ ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨: ' + data.message);
        }
      })
      .catch(err => {
        console.error('ëª¨ì„ ì™„ë£Œ ì˜¤ë¥˜:', err);
        alert('ëª¨ì„ ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message);
      });
    }
  }

  // íŒì—… ê´€ë ¨ í•¨ìˆ˜ë“¤
  function closeLatePopup() {
    latePopup.classList.add("hidden");
    currentProcessingIndex = -1;
  }
  
  function closeAbsencePopup() {
    absencePopup.classList.add("hidden");
    currentProcessingIndex = -1;
  }

  // ì§€ê° ìƒíƒœë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜
  let isCurrentlyLate = false;

  // ì°¸ì—¬ë¹„ í™•ì¸ ê´€ë ¨ í•¨ìˆ˜ë“¤
  function confirmPayment(isPaid) {
    document.getElementById("paymentPopup").classList.add("hidden");
    
    // ì‹¤ì œ ì¶œì„ ì²˜ë¦¬ (ì €ì¥ëœ ì§€ê° ìƒíƒœ ì‚¬ìš©)
    confirmAttendance(currentProcessingIndex, isCurrentlyLate);
    
    // ì§€ê° ìƒíƒœ ì´ˆê¸°í™”
    isCurrentlyLate = false;
    
    // ì°¸ì—¬ë¹„ ìƒíƒœì— ë”°ë¼ ë©”ì‹œì§€ í‘œì‹œ (ì„ íƒì‚¬í•­)
    if (!isPaid) {
      setTimeout(() => {
        showMessage(inputMessage, "ì°¸ì—¬ë¹„ ì…ê¸ˆì„ ìŠì§€ ë§ˆì„¸ìš”! ğŸ’°", "info");
      }, 1000);
    }
  }

  // ìƒíƒœ ê´€ë ¨ í•¨ìˆ˜ë“¤
  function getStatusDisplay(att) {
    const count = memberAttendanceCounts[att.name] || 1;
    if (att.status === "attended") return `${count}ë²ˆì§¸ ì°¸ì„ âœ…`;
    if (att.status === "late") return `${count}ë²ˆì§¸ ì°¸ì„ (ì§€ê°) â°`;
    if (att.status === "absent") return att.absenceReason ? `ê²°ì„ (${att.absenceReason})` : "ê²°ì„ ğŸš«";
    return "";
  }
  
  function getStatusColor(status) {
    if (status === "attended") return "text-green-600";
    if (status === "late") return "text-yellow-600";
    if (status === "absent") return "text-red-600";
    return "text-gray-600";
  }
  
  function removeAttendee(index) {
    if (confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      const att = attendees[index];
      
      // ì°¸ì„ íšŸìˆ˜ ê°ì†Œ (ì¶œì„ì´ë‚˜ ì§€ê°ì¸ ê²½ìš°ë§Œ)
      if ((att.status === "attended" || att.status === "late") && memberAttendanceCounts[att.name] > 0) {
        memberAttendanceCounts[att.name]--;
      }
      
      attendees.splice(index, 1);
      saveToLocalStorage();
      renderAttendees();
    }
  }

  // ì„œë²„ ì €ì¥ - Promise ë°˜í™˜
  function saveToServer(attendee) {
    return fetch("/save_attendance", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ 
        name: attendee.name,
        status: attendee.status,
        time: attendee.time,
        absence_reason: attendee.absenceReason || ""
      }),
    })
    .then(res => res.json())
    .then(data => {
      console.log("ì„œë²„ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤:", data);
      return data;
    })
    .catch(err => {
      console.log("ì„œë²„ ì €ì¥ ì‹¤íŒ¨:", err);
      throw err;
    });
  }

  // ì„œë²„ì—ì„œ ì‚¬ìš©ì ì¶œì„ íšŸìˆ˜ ê°€ì ¸ì˜¤ê¸°
  function loadUserAttendanceFromServer(username) {
    return fetch(`/api/get_attendance_count/${encodeURIComponent(username)}`)
      .then(res => res.json())
      .then(data => {
        if (data.status === 'ok') {
          return data.total_attended;
        } else {
          console.log('ì¶œì„ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', data.message);
          return 0;
        }
      })
      .catch(err => {
        console.log('ì¶œì„ ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', err);
        return 0;
      });
  }

  // ì´ˆê¸° ë¡œë”© ì‹œ ê¸°ì¡´ localStorage ë°ì´í„° ë³µêµ¬
  function initializeAttendanceCounts() {
    const savedCounts = JSON.parse(localStorage.getItem("member_counts") || "{}");
    memberAttendanceCounts = savedCounts;
    
    // ì„œë²„ì—ì„œ ìµœì‹  ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
    allMembers.forEach(async (name) => {
      try {
        const serverCount = await loadUserAttendanceFromServer(name);
        memberAttendanceCounts[name] = serverCount;
      } catch (err) {
        console.log(`${name} ì¶œì„ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:`, err);
      }
    });
    
    saveToLocalStorage();
  }

  // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
  function showMessage(element, message, type = "info") {
    element.textContent = message;
    element.className = `text-sm mt-2 text-center ${
      type === "error" ? "text-red-500" : type === "success" ? "text-green-600" : "text-[#3C1F1A]"
    }`;
    element.style.opacity = "1";
    setTimeout(() => {
      element.style.opacity = "0";
    }, 3000);
  }

  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
  document.addEventListener("click", function (event) {
    if (!event.target.closest("#nameInput") && !event.target.closest("#dropdown")) {
      hideDropdown();
    }
  });
  
  nameInput.addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
      event.preventDefault();
      const firstItem = dropdown.querySelector(".dropdown-item");
      if (firstItem && firstItem.textContent !== "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤") {
        addAttendee(firstItem.textContent);
      }
    }
  });

  // í˜„ì¬ ì‹œê°„ê³¼ ì§€ê° ìƒíƒœ ë””ë²„ê¹…ìš© í•¨ìˆ˜
  function updateTimeInfo() {
    const now = new Date();
    const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
    const timeStr = now.toLocaleTimeString('ko-KR');
    const dayStr = dayNames[now.getDay()];
    const isLate = isLateTime();
    
    const meetingTime = MEETING_TIMES[now.getDay()];
    const isMeetingDay = !!meetingTime;
    
    document.getElementById('timeInfo').textContent = 
      `${dayStr}ìš”ì¼ ${timeStr} | ëª¨ì„ì¼: ${isMeetingDay ? 'O' : 'X'} | ì§€ê°ì‹œê°„: ${isLate ? 'O' : 'X'}`;
  }



  // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
  document.addEventListener('DOMContentLoaded', function() {
    loadUsers();
    updateTodayInfo();
    updateTimeInfo(); // ì‹œê°„ ì •ë³´ í‘œì‹œ
    setInterval(updateTodayInfo, 30000); // 30ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
    setInterval(updateTimeInfo, 1000); // 1ì´ˆë§ˆë‹¤ ì‹œê°„ ì—…ë°ì´íŠ¸
  });


</script>

<style>
.dropdown-list {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid #d1d5db;
  border-top: none;
  border-radius: 0 0 12px 12px;
  max-height: 200px;
  overflow-y: auto;
  z-index: 1000;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.dropdown-item {
  padding: 12px 20px;
  cursor: pointer;
  border-bottom: 1px solid #f3f4f6;
}

.dropdown-item:hover {
  background-color: #f9fafb;
}

.dropdown-item:last-child {
  border-bottom: none;
}
</style>
{% endblock %}

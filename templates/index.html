<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜¤ëŠ˜ì˜ ì¶œì„</title>
  <style>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ìµœì†Œí•œì˜ ìŠ¤íƒ€ì¼ë§Œ ì ìš©í•˜ë˜, ë‚˜ì¤‘ì—
       ë¡œê³  ì»¬ëŸ¬/í…Œë§ˆ ìƒ‰ìƒì„ ë®ì–´ì”Œìš°ê¸° ì‰½ë„ë¡ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    body {
      font-family: sans-serif;
      padding: 2rem;
      max-width: 480px;
      margin: 0 auto;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
    }
    .dropdown-container {
      position: relative;
      width: 100%;
      max-width: 300px;
    }
    input[type="text"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .dropdown-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #fff;
      border: 1px solid #ccc;
      border-top: none;
      max-height: 150px;
      overflow-y: auto;
      z-index: 10;
      display: none;
    }
    .dropdown-item {
      padding: 8px;
      cursor: pointer;
    }
    .dropdown-item:hover {
      background-color: #f0f0f0;
    }
    .attendee-list {
      margin-top: 2rem;
    }
    .attendee-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #eee;
      padding: 8px 0;
    }
    .attendee-item span.name {
      flex: 1;
    }
    .attendee-item button {
      margin-left: 4px;
      padding: 4px 8px;
      font-size: 0.9rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .attendee-item button.attend {
      background-color: #4caf50;
      color: white;
    }
    .attendee-item button.late {
      background-color: #ff9800;
      color: white;
    }
    .attendee-item button.missed {
      background-color: #f44336;
      color: white;
    }
    .attendee-item button.delete {
      background-color: #ddd;
    }
    .save-button {
      margin-top: 2rem;
      padding: 10px 16px;
      background-color: #2196f3;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
    }
    .save-button:disabled {
      background-color: #90caf9;
      cursor: not-allowed;
    }
    .message {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #e91e63;
    }
  </style>
</head>
<body>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ìƒë‹¨: ë¡œê³  (í´ë¦­í•˜ë©´ í˜„ì¬ í˜ì´ì§€ë¡œ ì´ë™í•˜ê²Œ ì²˜ë¦¬)
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header>
    <div class="logo" onclick="location.href='/'">ğŸ“š BookCheck</div>
  </header>

  <h2>ì˜¤ëŠ˜ì˜ ì¶œì„</h2>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       1) ìë™ì™„ì„± + ì„ íƒ ê°€ëŠ¥ ì…ë ¥ì°½
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="dropdown-container">
    <input
      type="text"
      id="nameInput"
      placeholder="ì´ë¦„ ì…ë ¥ / ì„ íƒ"
      onfocus="showDropdown()"
      oninput="filterDropdown()"
      autocomplete="off"
    />
    <div id="dropdown" class="dropdown-list"></div>
  </div>
  <div id="inputMessage" class="message"></div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       2) ì˜¤ëŠ˜ ì¶œì„ì ë¦¬ìŠ¤íŠ¸
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="attendee-list" id="attendeeList"></div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       3) ìµœì¢… ì €ì¥ ë²„íŠ¼
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <button id="saveBtn" class="save-button" disabled>ì „ì²´ ëª…ë‹¨ ì €ì¥</button>
  <div id="saveMsg" class="message"></div>

  <script>
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // (0) ì„œë²„ ì¸¡ì—ì„œ Jinjaë¡œ ì „ë‹¬ëœ íšŒì› ë¦¬ìŠ¤íŠ¸
    //     ì‹¤ì œ ìš´ì˜ ì‹œì—ëŠ” DBì—ì„œ ì¡°íšŒí•œ ê°’ì„ ë„˜ê²¨ì£¼ë©´ ë©ë‹ˆë‹¤.
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const allMembers = {{ all_members | tojson }}; 

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // (1) DOM ìš”ì†Œ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const dropdown = document.getElementById("dropdown");
    const nameInput = document.getElementById("nameInput");
    const attendeeList = document.getElementById("attendeeList");
    const saveBtn = document.getElementById("saveBtn");
    const inputMessage = document.getElementById("inputMessage");
    const saveMsg = document.getElementById("saveMsg");

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // (2) ì˜¤ëŠ˜ ì¶œì„ì ëª…ë‹¨ì„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let attendees = JSON.parse(localStorage.getItem("today_attendees") || "[]");
    renderAttendees();  // í˜ì´ì§€ ë¡œë“œ ì‹œ, ì €ì¥ëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë¦¬ìŠ¤íŠ¸ë¡œ ê·¸ë ¤ì¤€ë‹¤.

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // (3) ë“œë¡­ë‹¤ìš´ ë³´ì´ê¸° / ìˆ¨ê¸°ê¸° / í•„í„°ë§
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showDropdown() {
      dropdown.style.display = "block";
      renderDropdown(allMembers);
    }

    function hideDropdown() {
      // í´ë¦­ ì´ë²¤íŠ¸ê°€ ëë‚œ ë’¤ ì ì‹œ ìˆ¨ê¸°ê¸°
      setTimeout(() => {
        dropdown.style.display = "none";
      }, 100);
    }

    function filterDropdown() {
      const query = nameInput.value.toLowerCase();
      // ì´ë¦„ì— queryê°€ í¬í•¨ëœ ê²ƒë§Œ í•„í„°ë§
      const filtered = allMembers.filter(name =>
        name.toLowerCase().includes(query)
      );
      renderDropdown(filtered);
    }

    function renderDropdown(list) {
      dropdown.innerHTML = "";
      list.forEach(name => {
        const item = document.createElement("div");
        item.className = "dropdown-item";
        item.textContent = name;
        item.onclick = () => addAttendee(name);
        dropdown.appendChild(item);
      });
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // (4) ì¶œì„ì ì¶”ê°€ í•¨ìˆ˜
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function addAttendee(name) {
      // 1) ë¹ˆ ë¬¸ìì—´ í˜¹ì€ ì´ë¯¸ ì¶”ê°€ëœ ì´ë¦„ì´ë¼ë©´ ë¬´ì‹œ
      if (!name || attendees.includes(name)) {
        inputMessage.textContent = attendees.includes(name)
          ? "ì´ë¯¸ ì¶”ê°€ëœ íšŒì›ì…ë‹ˆë‹¤."
          : "ìœ íš¨í•œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
        setTimeout(() => (inputMessage.textContent = ""), 1200);
        return;
      }

      // 2) attendees ë°°ì—´ì— ì¶”ê°€
      const now = new Date();
      // state: "pending" (ì•„ì§ ì¶œì„/ê²°ì„/ë„ì¥ ì—¬ë¶€ ì„ íƒ ì „)
      attendees.push({ name: name, status: "pending", time: now.toISOString() });
      saveToLocalStorage();
      renderAttendees();

      // 3) ì…ë ¥ì°½ ì´ˆê¸°í™”, ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
      nameInput.value = "";
      hideDropdown();
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // (5) ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function saveToLocalStorage() {
      localStorage.setItem("today_attendees", JSON.stringify(attendees));
      // ì €ì¥ ë°ì´í„° ìœ ë¬´ì— ë”°ë¼ ìµœì¢… ì €ì¥ ë²„íŠ¼ í™œì„±í™”
      saveBtn.disabled = attendees.length === 0;
      saveMsg.textContent = "";
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // (6) attendeesë¥¼ í™”ë©´ì— ë Œë”ë§
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderAttendees() {
      attendeeList.innerHTML = "";
      attendees.forEach((att, idx) => {
        const div = document.createElement("div");
        div.className = "attendee-item";
        div.id = `attendee-${idx}`;
        div.innerHTML = `
          <span class="name">${att.name}</span>
          <div>
            <button class="attend" onclick="markStatus(${idx}, 'attended')">ì¶œì„</button>
            <button class="late" onclick="markStatus(${idx}, 'late')">ì§€ê°</button>
            <button class="missed" onclick="markStatus(${idx}, 'missed')">ë„ì¥X</button>
            <button class="delete" onclick="removeAttendee(${idx})">âŒì‚­ì œ</button>
          </div>
        `;
        attendeeList.appendChild(div);

        // ìƒíƒœê°€ ì´ë¯¸ ì •í•´ì§„ ê²½ìš°, ë²„íŠ¼ ìƒ‰ìƒ/í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        if (att.status !== "pending") {
          updateStatusUI(idx);
        }
      });
      saveBtn.disabled = attendees.length === 0;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // (7) ì¶œì„/ì§€ê°/ë„ì¥X ë²„íŠ¼ í´ë¦­ ì‹œ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function markStatus(index, newStatus) {
      attendees[index].status = newStatus;
      // í´ë¦­í•œ ì‹œì ì„ ì¶œì„ ì‹œê°„ìœ¼ë¡œ ê¸°ë¡ (string í˜•íƒœ)
      attendees[index].time = new Date().toISOString();
      saveToLocalStorage();
      updateStatusUI(index);
    }

    function updateStatusUI(index) {
      const container = document.getElementById(`attendee-${index}`);
      const att = attendees[index];
      // ë²„íŠ¼ë“¤ ìˆ¨ê¸°ê³ , ìƒíƒœ í…ìŠ¤íŠ¸ë§Œ ë³´ì—¬ì£¼ë„ë¡ ë°”ê¿”ì¤ë‹ˆë‹¤.
      container.innerHTML = `
        <span class="name">${att.name}</span>
        <span>${statusText(att.status)}</span>
        <button class="delete" onclick="removeAttendee(${index})">âŒì‚­ì œ</button>
      `;
    }

    function statusText(status) {
      if (status === "attended") return "âœ… ì¶œì„";
      if (status === "late") return "â° ì§€ê°";
      if (status === "missed") return "âŒ ë„ì¥X";
      return "";
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // (8) ì¶œì„ì ì‚­ì œ í•¨ìˆ˜
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function removeAttendee(index) {
      attendees.splice(index, 1);
      saveToLocalStorage();
      renderAttendees();
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // (9) â€œì „ì²´ ëª…ë‹¨ ì €ì¥â€ ë²„íŠ¼ í´ë¦­ ì‹œ
    //     - ìµœì¢… ì„œë²„ë¡œ ì „ì†¡ (AJAX)
    //     - ì„±ê³µí•˜ë©´ localStorage ì´ˆê¸°í™”
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    saveBtn.addEventListener("click", () => {
      // JSONìœ¼ë¡œ ë³´ë‚¼ ë°ì´í„°: [{name, status, time}, ...]
      fetch("/api/save_attendance", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ attendees: attendees }),
      })
        .then(res => res.json())
        .then(data => {
          if (data.status === "ok") {
            saveMsg.textContent = "âœ… ì„œë²„ì— ì¶œì„ ëª…ë‹¨ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!";
            localStorage.removeItem("today_attendees");
            attendees = [];
            renderAttendees();
          } else {
            saveMsg.textContent = "âŒ ì €ì¥ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
          }
        })
        .catch(err => {
          console.error(err);
          saveMsg.textContent = "âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        });
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // (10) ë“œë¡­ë‹¤ìš´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.addEventListener("click", function (event) {
      if (!event.target.closest(".dropdown-container")) {
        hideDropdown();
      }
    });
  </script>

</body>
</html>
